<html>
<title>Patrimonio</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#d72525"><link rel="icon" type="image/png" href="/imgFiles/presentacion.png">
<link rel="stylesheet" href="/cssFiles/estilos2.css">
<!-- iconos-->
<link rel="stylesheet" href='/cssFiles/iconos.min.css'>
<link rel="stylesheet" href='/cssFiles/bootstrap.min.css'>
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>
<body >

<!-- Top container -->
<div class="w3-bar w3-top w3-black w3-large" style="z-index:4">
  <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>  Menu</button>&nbsp;&nbsp;&nbsp;INVENTARIO
  <span class="w3-bar-item w3-right"><form name='frmsalir' action='' method='post'><input type='hidden' name='accion' value='cerrarSesion'><a href='http://192.168.2.12:3000/logout' >Salir</a>&nbsp;</form></span>
</div>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:200px;" id="mySidebar"><br>
  <div class="w3-container w3-row">
    <div class="w3-col s4">
			<!-- persona -->

			<!-- persona -->
    </div>
    <div class="w3-col s8 w3-bar">
      <span>  Bienvenido <h5><%=data.usuario.username%></h5></span><br>

      <a href="#" class="w3-bar-item w3-button"><i class="fa fa-user"></i></a>
      <a href="#" class="w3-bar-item w3-button"><i class="fa fa-cog"></i></a>

    </div>

  </div>
  <hr>
  <div class="w3-container">
    <h5>Menu</h5>
  </div>
  <div class="w3-bar-block">
    <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>  Close Menu</a>
    <a href="http://192.168.2.12:3000/backend" class="w3-bar-item w3-button w3-padding"><i class="fa fa-users fa-fw"></i>Menu</a>
  <div class="w3-bar-item w3-button" onclick="myAccFunc()">
 COMPUTADORA<i class="fa fa-caret-down"></i></div>
 <div id="demoAcc" class="w3-hide w3-white w3-card-4">
   <a href="http://192.168.2.12:3000/ordenador" class="w3-bar-item w3-button">ORDENADOR</a>
   <a href="http://192.168.2.12:3000/cpu" class="w3-bar-item w3-button">CPU</a>
   <a href="http://192.168.2.12:3000/monitor" class="w3-bar-item w3-button">MONITOR</a>
   <a href="http://192.168.2.12:3000/teclado" class="w3-bar-item w3-button">TECLADO</a>

 </div>

 <div class="w3-bar-item w3-button" onclick="myAccFunc2()">
PATRIMONIO<i class="fa fa-caret-down"></i></div>
<div id="demoAcc2" class="w3-hide w3-white w3-card-4">
  <a href="http://192.168.2.12:3000/patrimonio" class="w3-bar-item w3-button">AGREGAR</a>
    <a href="http://192.168.2.12:3000/formpatrim" class="w3-bar-item w3-button">FORMATO PATRIMONIO</a>
</div>
</div>
</nav>


<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:300px;margin-top:43px;">

  <!-- Header -->


  <!-- Footer -->
  <footer class="w3-container w3-padding-16 w3-light-grey">
		<!--MI CODIGO-->
		<body ng-cloack>
			<form ng-app="app" ng-controller="frmpatrimonio" ng-init="id=0;campo='descripcion';operador='LIKE';valor=''"  name='exampleForm' novalidate>
      <div class='container' style="width: 100%">
				<div class='row'>
					<div class='col-xs-3'>
						<div style="width: 100%;margin: 1px auto">
				<div class='row space'>
					<label ></label> {{id}}
					</div>

<div class='row space'>
<label for="">Descripcion</label>
<select ng-model="descripcion" class="form-control w3-animate-zoom">
  <option value="CPU">CPU</option>
  <option value="MONITOR">MONITOR</option>
  <option value="TECLADO">TECLADO</option>
</select>
</div>

<div class='row space'>
<label for="">CODIGO PATRIMONIO</label>
<input type='text' ng-model="CODPATRIM" class="form-control w3-animate-zoom"
placeholder='ingrese dato' name='CODPATRIM'
required   ng-class='{ error: exampleForm.CODPATRIM.$invalid && !exampleForm.$pristine }' >
<span  ng-show=' exampleForm.CODPATRIM.$error.required '><p> Ingrese Datos en el campo</p></span>
</div>

<div class='row space'>
<label for="">MODELO</label>
<input type='text' ng-model="modelo" class="form-control w3-animate-zoom"
placeholder='ingrese dato' name='modelo'
required   ng-class='{ error: exampleForm.modelo.$invalid && !exampleForm.$pristine }' >
<span  ng-show=' exampleForm.modelo.$error.required '><p> Ingrese Datos en el campo</p></span>
</div>

<div class='row space'>
<label for="">SERIE</label>
<input type='text' ng-model="serie" class="form-control w3-animate-zoom"
placeholder='ingrese dato' name='serie'
required   ng-class='{ error: exampleForm.serie.$invalid && !exampleForm.$pristine }' >
<span  ng-show=' exampleForm.serie.$error.required '><p> Ingrese Datos en el campo</p></span>
</div>

<div class='row space'>
<label for="">MARCA</label>
<input type='text' ng-model="marca" class="form-control w3-animate-zoom"
placeholder='ingrese dato' name='marca'
required   ng-class='{ error: exampleForm.marca.$invalid && !exampleForm.$pristine }' >
<span  ng-show=' exampleForm.marca.$error.required '><p> Ingrese Datos en el campo</p></span>
</div>



<div class='row space' ng-init='persona()'>
<label >PERSONA</label>
<select ng-model="persona_id"  name="persona_id" class="form-control">
  <option ng-repeat="a in init2" value='{{a.id}}'>{{a.PR_NOMBRE}}</option>
</select>
</div>
<div class='row space'>
            <button class='btn btn-info' ng-click='reload()'><span class='fa fa-plus-circle'></span></button>
            <button class='btn btn-success' ng-click='guardar()' ng-disabled='!exampleForm.$valid'>Guardar</button>
            <button class='btn btn-danger' ng-click="eliminar(id);" ng-disabled='!exampleForm.$valid' >Eliminar</button>
        </div>
		    </div>
				</div>

				<div>

					</div>
				<div class='col-xs-9'>
				<div class='row space' >
					<div class='col-sm-12'>
						<table class='table'>
							<tr>
								<th>
	        <select ng-model="campo" class="form-control w3-animate-zoom">
	         	<option value="descripcion">Descripcion</option>
						<option value="a.CODPATRIM">Codigo Patrimonio</option>
						<option value="c.PR_NOMBRE">Usuario Asignado</option>

	        </select>
				</th>
			<th>
	        <select ng-model="operador" class="form-control w3-animate-zoom">
	           	<option value="LIKE">Similar</option>
	            <option value="=">Igual</option>
	            <option value=">">Mayor</option>
	            <option value="<">Menor..</option>
	        </select>

				</th>

			<th>
	            <input type="text" ng-model="valor" value="" size='30'/>
								<button class='btn btn-default w3-animate-zoom' ng-click="buscar();">Buscar</button>
						</th>

			</th>
			</tr>
				</table>

	        </input>

	<table   class='table table-bordered table-hover w3-animate-zoom' ng-init='configPages()'  >
		<tr><th>No</th><th>Descripcion</th><th>Patrimonio</th><th>Modelo</th><th>Serie</th><th>Marca</th><th>Usuario</th></tr>
				  <tr ng-repeat="x in encs| startFromGrid: currentPage * pageSize | limitTo: pageSize"  >
				          <th>{{$index+1}}</th>
	                <td>{{x.descripcion}}</td>
	                <td>{{x.CODPATRIM}}</td>
                    <td>{{x.modelo}}</td>
                      <td>{{x.serie}}</td>
                        <td>{{x.marca}}</td>
	                <td>{{x.PR_NOMBRE}}</td>
	                <td><input type="button" class="btn btn-info" ng-click="cad=x.id+','+x.descripcion+','+x.CODPATRIM+','+x.modelo+','+x.serie+','+x.marca+','+x.persona_id; mostrarDatos1(cad);" value="Modificar">
	                <button class="btn btn-danger"  ng-click="eliminar(x.id);"><span class="fa fa-trash-o"></span></button>
	                </td>
								<tr>
									<td></td>
								</tr>

				  </tr>

	</table>
	<center>
	<div class='btn-group'>
					<button type='button' class='btn btn-default' ng-disabled='currentPage == 0' ng-click='currentPage = currentPage - 1'>&laquo;</button>
					<button type='button' class='btn btn-default' ng-disabled='currentPage == page.no - 1' ng-click='setPage(page.no)' ng-repeat='page in pages'>{{page.no}}</button>
					<button type='button' class='btn btn-default' ng-disabled='currentPage >= encs.length/pageSize - 1' , ng-click='currentPage = currentPage + 1'>&raquo;</button>
				</div>
	</center>
	</div>
		</div>
		</div>
		</div>
		</div>

		</form>

		<!--FIN DE MI CODIGO-->
  </footer>
	<script>
	// Get the Sidebar
	var mySidebar = document.getElementById("mySidebar");

	// Get the DIV with overlay effect
	var overlayBg = document.getElementById("myOverlay");

	// Toggle between showing and hiding the sidebar, and add overlay effect
	function w3_open() {
	    if (mySidebar.style.display === 'block') {
	        mySidebar.style.display = 'none';
	        overlayBg.style.display = "none";
	    } else {
	        mySidebar.style.display = 'block';
	        overlayBg.style.display = "block";
	    }
	}

	// Close the sidebar with the close button
	function w3_close() {
	    mySidebar.style.display = "none";
	    overlayBg.style.display = "none";
	}
	</script>
  <!-- End page content -->
</div>
<script src="/angularjs/angular.min.js"></script>

<script>
function myAccFunc() {
  var x = document.getElementById("demoAcc");
  if (x.className.indexOf("w3-show") == -1) {
      x.className += " w3-show";
      x.previousElementSibling.className += " w3-green";
  } else {
      x.className = x.className.replace(" w3-show", "");
      x.previousElementSibling.className =
      x.previousElementSibling.className.replace(" w3-green", "");
  }
}
function myAccFunc2() {
var x = document.getElementById("demoAcc2");
if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
    x.previousElementSibling.className += " w3-green";
} else {
    x.className = x.className.replace(" w3-show", "");
    x.previousElementSibling.className =
    x.previousElementSibling.className.replace(" w3-green", "");
}
}

</script>
<script type="text/javascript">

var app = angular.module("app", []);
app.controller("frmpatrimonio",   function($scope,$http)
{
	$scope.formData = {};
	$scope.currentPage = 0;
  $scope.pageSize = 10; //  tamño de la Pagina
  $scope.pages = [];

	$scope.reload = function()
{
   location.reload();
}


$scope.configPages = function() {
			$scope.pages.length = 0;
			var ini = $scope.currentPage - 4;
			var fin = $scope.currentPage + 5;
			if (ini < 1) {
				ini = 1;
				if (Math.ceil($scope.encs.length / $scope.pageSize) > 10)
					fin = 10;
				else
					fin = Math.ceil($scope.encs.length / $scope.pageSize);
			} else {
				if (ini >= Math.ceil($scope.encs.length / $scope.pageSize) - 10) {
					ini = Math.ceil($scope.encs.length / $scope.pageSize) - 10;
					fin = Math.ceil($scope.encs.length / $scope.pageSize);
				}
			}
			if (ini < 1) ini = 1;
			for (var i = ini; i <= fin; i++) {
				$scope.pages.push({
					no: i
				});
			}

			if ($scope.currentPage >= $scope.pages.length)
				$scope.currentPage = $scope.pages.length - 1;
		};

		$scope.setPage = function(index) {
			$scope.currentPage = index - 1;
		};

//alertas
function AlertsCtrl($scope, alertsManager) {
    $scope.alerts = alertsManager.alerts;
}

//fin alertas
$scope.submitForm = function (formData) {
	alert('Form submitted with' + JSON.stringify(formData));
};
 var alerta="Datos Guardados Correctamente";
	$scope.guardar=function(){
    id=$scope.id,
    url='/guardado/patrimonio';
      if (id>0) {
        url='/update/patrimonio';
      };
    $http.post(url,
		{
			'id':id,
			'descripcion':$scope.descripcion,
			'CODPATRIM':$scope.CODPATRIM,
      'modelo':$scope.modelo,
      'serie':$scope.serie,
      'marca':$scope.marca,
      'persona_id':$scope.persona_id,
		}).then(function(response)
			{

			});
      	alert("DATOS GUARDADOS CORRECTAMENTE");
		}

    $scope.persona=function()
    {
      $http.post('/persona/patrimonio',
      {
        'accion':'persona',
      }).then(function(response)
        {
          $scope.init2=response.data;
          // console.log($scope.init2);
        });
    }
	$scope.buscar=function()
	{
		$http.post('/buscar/patrimonio',
		{	'campo':$scope.campo,
			'operador':$scope.operador,
			'valor':$scope.valor,
			'accion':'buscar',
		}).then(function(response)
			{
				$scope.encs=response.data;
			});
	}
$scope.encs=function(id,ruc,nombre,telefono,imagen)
{
}
	$scope.buscarRUC=function(datos)
	{	$http.post('../controllers/cpatrimonio.php',
		{	'ruc':$scope.ruc,
			'accion':'buscarRUC',
		}).then(function(response)
		{
		 $scope.id=response.data[0][0];
		 $scope.descripcion=response.data[0][1];
		 $scope.CODPATRIM=response.data[0][2];
		 $scope.persona_id=response.data[0][3];
	 });

	}
	///eliminamos  $scope.removeRow(id);
	$scope.eliminar=function(id)
	{
		$http.post('/eliminar/patrimonio',
		{	'id':id,
			'accion':'eliminar',
		}).then(function(response)
			{
				 $scope.removeRow(id);
				alert(response.data);
			});
		}
	$scope.removeRow = function(id)
{  	var index = -1;
		var comArr = eval($scope.encs);
		for( var i = 0; i < comArr.length; i++ )
	{   if(comArr[i].id === id)
		{    index = i;
						 break;
				}
		}
	if( index === -1 )
			alert("Tienes  Erros de codigo");
	else
			$scope.encs.splice(index, 1);
};
//  fin de la eliminacion
$scope.mostrarDatos1=function(data)
	{	d=data.split(",");
		$scope.id=d[0];
		$scope.descripcion=d[1];
		$scope.CODPATRIM=d[2];
    $scope.modelo=d[3];
    $scope.serie=d[4];
    $scope.marca=d[5];
    $scope.persona_id=d[6];
	};
})
.filter('startFromGrid', function() {
  return function(input,start)
	{
    start = +start;
		if(angular.isArray(input) && input.length > 0) {
             return input.slice(start);
        }
				return input;
  }
});


</script>
</body>
</html>
