
<html>
<title>Tienda  Yesly Venta de Abarrotes</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#d72525"><link rel="icon" type="image/png" href="/imgFiles/presentacion.png">
<link rel="stylesheet" href="/cssFiles/estilos2.css">
<!-- iconos-->
<link rel="stylesheet" href='/cssFiles/iconos.min.css'>
<link rel="stylesheet" href='/cssFiles/bootstrap.min.css'>
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}

</style>
<style>
   @media screen {
  #printSection {
      display: none;
  }
}
@media print {
  body * {
    visibility:hidden;
  }
  #printSection, #printSection * {
    visibility:visible;
  }
  #printSection {
    position:absolute;
    left:0;
    top:0;
  }
}
 </style>

<body class="w3-light-grey"  >

<!-- Top container -->
<div class="w3-bar w3-top w3-black w3-large" style="z-index:4">
  <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>  Menu</button>&nbsp;&nbsp;&nbsp;Sistema de Ventas de Tienda
  <span class="w3-bar-item w3-right"><form name='frmsalir' action='' method='post'><input type='hidden' name='accion' value='cerrarSesion'><a href='#' onclick='cerrarSesion()'>Salir</a>&nbsp;</form></span>
</div>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:300px;" id="mySidebar"><br>
  <div class="w3-container w3-row">
    <div class="w3-col s4">
			<!-- persona -->

			<!-- persona -->
    </div>
    <div class="w3-col s8 w3-bar">
      <span> Bienvenido <h1><%=data.usuario.username%></h1>   </span><br>
      <a href="#" class="w3-bar-item w3-button"><i class="fa fa-envelope"></i></a>
      <a href="#" class="w3-bar-item w3-button"><i class="fa fa-user"></i></a>
      <a href="#" class="w3-bar-item w3-button"><i class="fa fa-cog"></i></a>

    </div>

  </div>
  <hr>
  <div class="w3-container">
    <h5>opciones</h5>
  </div>
  <div class="w3-bar-block">
    <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>  Close Menu</a>
    <a href="http://localhost:3000/backend" class="w3-bar-item w3-button w3-padding"><i class="fa fa-users fa-fw"></i>Menu</a>
    <a href="http://localhost:3000/cliente" class="w3-bar-item w3-button w3-padding"><i class="fa fa-eye fa-fw"></i>Clientes</a>
    <a href="http://localhost:3000/proveedor" class="w3-bar-item w3-button w3-padding "><i class="fa fa-users fa-fw"></i>Proveedor</a>
    <a href="http://localhost:3000/producto" class="w3-bar-item w3-button w3-padding"><i class="fa fa-bullseye fa-fw"></i>Producto</a>
    <a href="http://localhost:3000/venta" class="w3-bar-item w3-button w3-padding w3-lime"><i class="fa fa-diamond fa-fw"></i>Ventas</a>
    <a href="http://localhost:3000/credito" class="w3-bar-item w3-button w3-padding"><i class="fa fa-bell fa-fw"></i>Credito</a>
    <a href="http://localhost:3000/operador" class="w3-bar-item w3-button w3-padding "><i class="fa fa-bank fa-fw"></i>Operadores</a>
    <a href="http://localhost:3000/recarga" class="w3-bar-item w3-button w3-padding"><i class="fa fa-history fa-fw"></i>Recarga Virtual</a>
    <a href="http://localhost:3000/graficos" class="w3-bar-item w3-button w3-padding "><i class="fa fa-cog fa-fw"></i> Reportes</a>
    <a href="http://localhost:3000/pedidos" class="w3-bar-item w3-button w3-padding "><i class="fa fa-cog fa-fw"></i> pedidos</a>
  </div>
</nav>


<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:300px;margin-top:43px;">

  <!-- Header -->


  <!-- Footer -->
  <footer class="w3-container w3-padding-16 w3-light-grey">
		<!--MI CODIGO-->
    <div style='background-color:#AAB7B8;color:white;text-align:center;font-size:20;height:50'>AL AGREGAR UN PRODUCTO ACTUALIZAR <i class="fa fa-exclamation-triangle w3-xxxlarge"></i></div>
    <div class='container' style="width: 100%">
    		<div class='row'>
    			<div class='col-xs-3'>
    	<!--<th colspan='5'><button onclick="location.href='provando.php'" class='btn btn-success'>IMPRIMIR</button></th>-->
    		</div>
    	</div>
    	<div class='col-xs-9'>
    	<div class='row space'  >
    		<div class='col-sm-12'>
    			<table >

    				<tr>
    					<th>
    		<select id='campo' class="form-control">

    			<option >codigo barra</option>


    		</select>
    	</th>
    	<th>
    		<select id='operador' class="form-control">
    			<option >Similar a</option>
    		</select>
    	</th>
    	<th>

    		<input type='text' id='valor' size='20' onkeydown='getTotalRegs()' class="form-control" >

    	</th>
    	<th>

    		<div >
    		<button onclick='getTotalRegs()' class='btn btn-primary'><i class="fa fa-shopping-cart w3-xxxlarge"></i>Añadir</button>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#1"> <span class="glyphicon glyphicon-plus"></span>Compras</button>
    	</div>
    </th>

        </tr>
        </table>
    		</div>
    	<div class='row' align="left" id='results'>
    	</div>
    	</input>
    	<div id='footer' align="center"  ></div>
      <div id="1" class="modal fade" role="dialog">
        <div class="modal-dialog" >
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title"><div style='background-color:#AAB7B8;color:white;text-align:center;font-size:20;height:50'>REALIZAR VENTA <i class="fa fa-shopping-cart w3-xxxlarge"></i></div></h4>
            </div>
            <div class="modal-body">
           <div class='container' id='modal'>
             <!-- miniformulario modal-->

             <div class='container' style="width: 100%">
     <div class='row'>
       <div class='col-xs-3'>
         <div id="printThis">
          <center><h1>Boleta de Venta</h1></center>
          <lavel>Cliente:</lavel><input type="text" class="form-control">
          <div class="modifyMe">Sistema  yesly
              &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
              &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
               R.U.C.:10044396535</div>
    <div class='col-sm-5'   id='carrito'></div>
    <div class="modifyMe"><label>Estado:Cancelado</label> </div>
        Los Cipreses Mza. 8 Lote 24 <br>
        Cel:953739999-953694100

    </div>
     </div>
     </div>
     <button class='btn btn-success' id="btnPrint">Imprimir Boleta</button>


           <!--miniformuariomodal-->

         </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
          </div>
        </div>
     </div>
      </div>
     </div>


    </div>
    </div>




    </div>

		<!--FIN DE MI CODIGO-->
  </footer>
	<script>
	// Get the Sidebar
	var mySidebar = document.getElementById("mySidebar");

	// Get the DIV with overlay effect
	var overlayBg = document.getElementById("myOverlay");

	// Toggle between showing and hiding the sidebar, and add overlay effect
	function w3_open() {
	    if (mySidebar.style.display === 'block') {
	        mySidebar.style.display = 'none';
	        overlayBg.style.display = "none";
	    } else {
	        mySidebar.style.display = 'block';
	        overlayBg.style.display = "block";
	    }
	}

	// Close the sidebar with the close button
	function w3_close() {
	    mySidebar.style.display = "none";
	    overlayBg.style.display = "none";
	}
	</script>
  <script src='/javas/jquery-2.1.4.min.js'></script>
<script src='/boostrap/bootstrap.min.js'></script>
<script type="text/javascript">
var a; //El dataset de registros
var p;
var filaactual=-1;//La fila actual
var filanueva;//Vector con los nuevos datos de la fila para actualizar a en caso de edicion.
var tamano=10;//El tamano de la pagina(n de registros x pagina)
var carrito=new Array();
document.getElementById("btnPrint").onclick = function () {
    printElement(document.getElementById("printThis"));

    var modThis = document.querySelector("#printSection .modifyMe");
    modThis.appendChild(document.createTextNode(" "));

    window.print();
}

function printElement(elem) {
    var domClone = elem.cloneNode(true);

    var $printSection = document.getElementById("printSection");

    if (!$printSection) {
        var $printSection = document.createElement("div");
        $printSection.id = "printSection";
        document.body.appendChild($printSection);
    }

    $printSection.innerHTML = "";

    $printSection.appendChild(domClone);
}

function getTotalRegs() //Obtiene el total de registros de la busqueda
{	campo=$('#campo').val();
	operador=$('#operador').val();
	valor=$('#valor').val();
	$.ajax({
		type:'post',
		url:'/getbuscar/producto',
		data:'campo='+campo+'&operador='+operador+'&valor='+valor+'&accion=getbuscar',
		success:function(html)
		{

			buscarP(0);
		}
	});
}
function buscarP(ini) //Busca registros de acuerdo a datos de paginacion
{	campo=$('#campo').val();
	operador=$('#operador').val();
	valor=$('#valor').val();
	$.ajax({
		type:'post',
		url:'/venta/producto',
		dataType:'json',
		data:'campo='+campo+'&operador='+operador+'&valor='+valor+"&inicio="+ini+"&total="+tamano+'&accion=buscar',
		success:function(html)
		{
			a=html;
			formatearResults()
		}
	});
}
function formatearResults()//Visualiza el contenido de la matriz a
{	html="<table ><tr><th>Nro </th><th>DESCRIPCION</th><th>MARCA</th><th>CONTENIDO</th><th> PRECIO</th><th> STOCK</th><th> ESTADO</th><th>PRESENTACION</th><th> UNIDADES </th></tr>";
	na=a.length;

	c=1;
	for(i=0;i<na;i++)
	{
		html+="<tr><th>"+c+"</th><td>"+a[i].descripcion+"</td><td>"+a[i].marca+"</td><td>"+a[i].cantCont+"&nbsp"+a[i].descripCont+"</td><td> "+a[i].precioOf+"</td><td> "+a[i].stock+"</td><td> "+a[i].estado+"</td><td> "+a[i].presentacion+"</td><td><input class='form-control' type='text' name='can' style='width:65px;'></td><td><button class='btn btn-primary'onclick='agregarCarrito("+i+")'><span class='glyphicon glyphicon-plus'></span>&nbsp;&nbsp;agregar</button></td></tr>";
		c++;
	}
	html+="</table>";
	$('#results').html(html);
}

function agregarCarrito(row)
{		can=getCantidad();
		if(parseInt(can)>parseInt(a[row].stock))
				alert('Solo contamos con '+ a[row].stock +' unidades');
		else
		{	limpiar();
			sbt=can*a[row].precioOf;
			fila=new Array(a[row].id,a[row].descripcion,a[row].precioOf,can,sbt,row);
			carrito.push(fila);

			printCarrito();

			//Actualizamos el stock en la lista de productos
			updateStock(can,row);

		}
}
function updateStock(can,row)
{	nstock=parseInt(a[row].precioOf)-parseInt(can);
	fila=new Array(a[row].id,a[row].descripcion,a[row].codigobarra,a[row].precioAd,a[row].precio,a[row].precioOf,a[row].cantidad,nstock,a[row].photo,
    a[row].fechVen,a[row].estado,a[row].presentacion,a[row].descripCont,a[row].cantCont,a[row].marca_id,a[row].Catproducto_id);
	a.splice(row,1,fila);
	formatearResults()
}
function printCarrito()
{	html="<table class='table table-hover'><tr><th>No</th><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Sub-Total</th>";
	nc=carrito.length;
	c=1;s=0;
	for(i=0;i<nc;i++)
	{	s+=carrito[i][4];
		html+="<tr><td>"+c+"</td><td>"+carrito[i][1]+"</td><td>"+carrito[i][2]+"</td><td>"+carrito[i][3]+"</td><td>"+carrito[i][4]+"</td></tr>";c++;
	}
	btn="";
	if(nc>0)
		btn="<tr><th colspan='5'></th></th></tr>";
	html+="<tr><th colspan='4' align='right'>TOTAL  </td><th>S/.  "+s+"</th></tr>"+btn+"</table>";

	$('#carrito').html(html);
}
function comprar()
{  datos=getDatosCarrito();
	$.ajax({
		type:'post',
		url:'../controllers/ccompra.php',
		data:datos+"&accion=comprar",
		success:function(html)
		{ console.log(html)
			alert(html);
		}
	});
}


function getDatosCarrito()
{
	nc=carrito.length;
	cad="carrito=";
	s=0;
	for(i=0;i<nc;i++)
	{	cad+=carrito[i][0]+"*"+carrito[i][3]+"/";
		s+=carrito[i][4];
	}
	cad+="&total="+s;
	return cad;
}
function deleteRow(fila)//Elimina una fila del carrito
{	//Actualizamos la matriz json de productos
	updateStock(-parseInt(carrito[fila][3]),carrito[fila][5]);
	/////
	carrito.splice(fila,1);
	printCarrito();
}
function getCantidad()
{	c=document.getElementsByName("can");
	ca=0;
	nc=c.length;
	for(i=0;i<nc;i++)
	{	if(c[i].value>0)
		{	ca=c[i].value;
			break;
		}
	}
	return ca;
}
function limpiar()
{	c=document.getElementsByName("can");
	nc=c.length;
	for(i=0;i<nc;i++)
	{	if(c[i].value!="")
		{	c[i].value="";
			break;
		}
	}
}

</script>
  <!-- End page content -->
</div>

</body>
</html>
